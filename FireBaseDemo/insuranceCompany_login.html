<!DOCTYPE html>
<html lang="zh-TW">

<head>
	<title>保險公司登入</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
		integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
	<!--===============================================================================================-->
	<link rel="icon" type="image/png" href="images/icons/favicon.ico" />
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/Linearicons-Free-v1.0.0/icon-font.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/daterangepicker/daterangepicker.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="css/util.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
	<!--===============================================================================================-->
</head>

<body>

	<div class="limiter">
		<div class="container-login100">
			<div class="wrap-login100">
				<div class="login100-form-title" style="background-image: url(images/bg-01.png);">
					<span class="login100-form-title-1">
						保險公司登入
					</span>
				</div>

				<form class="login100-form validate-form">

					<div class="wrap-input100 m-b-18">
						<span class="label-input100">公司名稱</span>
						<select class="input100" name="CompanyName" id="CompanyName" style="margin-top: 11px;">
							<option value="default">請選擇公司</option>
							<option value="TaiwanLife">臺灣人壽</option>
							<option value="ChinaLife">中國人壽</option>
							<option value="CathayLife">國泰人壽</option>
							<option value="NanShanLife">南山人壽</option>
						</select>

					</div>

					<div class="wrap-input100 validate-input m-b-18" data-validate="公司編號必填">
						<span class="label-input100">公司編號</span>
						<input class="input100" id="CompanyNumber" type="text" name="companyNumber"
							placeholder="請輸入公司編號">
						<span class="focus-input100"></span>
					</div>

					<div class="wrap-input100 validate-input m-b-18" data-validate="登入密碼必填">
						<span class="label-input100">登入密碼</span>
						<input class="input100" id="Password" type="password" name="pass" placeholder="請輸入預設密碼">
						<span class="focus-input100"></span>
					</div>

					<div class="flex-sb-m w-full p-b-30">
						<div class="contact100-form-checkbox">
							<!--<input class="input-checkbox100" id="ckb1" type="checkbox" name="remember-me">
							<label class="label-checkbox100" for="ckb1">
								Remember me
							</label>-->
						</div>

						<div>
							<a href="#" class="txt1 InfoNeedNow">使用須知</a>
						</div>
					</div>

					<div class="container-login100-form-btn">
						<button class="login100-form-btn" id="loginBtn">登入</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<div id="InfoNeedNow" title="使用須知" style="display:none;">
		<p style="font-size: 16px;">測試用訊息</p>
	</div>

	<!--===============================================================================================-->
	<script src="vendor/jquery/jquery-3.2.1.min.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/animsition/js/animsition.min.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/bootstrap/js/popper.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/select2/select2.min.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/daterangepicker/moment.min.js"></script>
	<script src="vendor/daterangepicker/daterangepicker.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/countdowntime/countdowntime.js"></script>
	<!--===============================================================================================-->
	<script src="js/main.js"></script>

</body>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"
	integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"
	integrity="sha512-uto9mlQzrs59VwILcLiRYeLKPPbS/bT71da/OEBYEwcdNUk8jYIy+D176RYoop1Da+f9mvkYrmj5MCLZWEtQuA=="
	crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<link href="https://code.jquery.com/ui/1.13.1/themes/ui-lightness/jquery-ui.css" rel="stylesheet" />
<script src="https://www.gstatic.com/firebasejs/4.3.0/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-database.js"></script>
<script type="module">
	// Import the functions you need from the SDKs you need
	import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js";
	import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-analytics.js";
	// TODO: Add SDKs for Firebase products that you want to use
	// https://firebase.google.com/docs/web/setup#available-libraries

	// Your web app's Firebase configuration
	// For Firebase JS SDK v7.20.0 and later, measurementId is optional
	const firebaseConfig = {
		apiKey: "AIzaSyDtTxfCIJIfPTEw44Ah5I1lpjiDO96FlJM",
		authDomain: "mydatabase-8f225.firebaseapp.com",
		databaseURL: "https://mydatabase-8f225-default-rtdb.firebaseio.com",
		projectId: "mydatabase-8f225",
		storageBucket: "mydatabase-8f225.appspot.com",
		messagingSenderId: "68532714578",
		appId: "1:68532714578:web:fc038b336827906b65338b",
		measurementId: "G-68RXLWEXS7"
	};


	// Initialize Firebase
	firebase.initializeApp(firebaseConfig);

	//建立 Firebase 中的 database 功能
	var db = firebase.database();

	// Reference: https://stackoverflow.com/questions/10730362/get-cookie-by-name
	function getCookie(name) {
		const value = `; ${document.cookie}`;
		const parts = value.split(`; ${name}=`);
		if (parts.length === 2) return parts.pop().split(';').shift();
	}

	//刪除cookie
	function delCookie(name) {
		var exp = new Date();
		exp.setTime(exp.getTime() - 1); //強制讓 cookie 過期
		var cval = getCookie(name);
		if (cval != null) document.cookie = name + "=" + cval + ";expires=" + exp.toGMTString();
	}

	var companyNumber = document.getElementById('CompanyNumber');
	var password = document.getElementById('Password');
	var loginBtn = document.getElementById('loginBtn');
	var companyName = document.getElementById('CompanyName');
	var InfoNeedNow = document.querySelector('.InfoNeedNow');

	if (getCookie("uid") != null) { //強制登出已登入的一般使用者以免影響保險公司登入
		delCookie("uid");
	}

	if(getCookie("CompanyName") != null){ //每次回到登入頁面都先清除登入資料
		delCookie("CompanyName");
		document.cookie = 'LoginStatus=No';
	}

	//處理登入事件
	loginBtn.addEventListener('click', function (e) {

		e.preventDefault();

		if (companyName.value == "default") {
			alert("請選擇保險公司名稱!");
		}
		if (companyName.value != "default") {
			db.ref("/InsuranceCompany/" + String(companyName.value)).once('value', function (snapshot) {
				//var size = Object.keys(data).length; 資料庫 key 的長度取得
				var data = snapshot.val(); //讀出資料庫的使用者資料
				console.log(data);
				if (data.CompanyId != companyNumber.value) {
					alert("公司編號輸入有誤，請重新輸入!");
				}
				if (data.CompanyId == companyNumber.value) {
					if (data.Password != password.value) {
						alert("公司預設密碼輸入有誤，請重新輸入!");
					}
					if (data.Password == password.value) {
						alert("登入成功，即將跳轉到保險公司頁面");
						document.cookie = 'CompanyName='+ String(companyName.value);
						document.cookie = 'LoginStatus=Yes';
						window.location = 'InsuranceCompany.html';
					}
				}
			});
		}
	});

	//使用須知的彈出視窗
	InfoNeedNow.addEventListener("click", e => {
		$("#InfoNeedNow").dialog({ //彈出視窗的外觀大小設定
			width: 360,
			height: 250,
			modal: true,
			show: { effect: 'fade', duration: 500 },
			hide: { effect: 'fade', duration: 500 }
		});
		$("#InfoNeedNow").show(); //實際顯示視窗
	});

</script>
<style>
	div.ui-widget-header {
		background: #57B846;
		border: 0;
		color: #fff;
		font-weight: normal;
	}

	.ui-dialog-titlebar-close {
		padding: 0px !important;
	}

	.ui-dialog-titlebar-close:after {
		content: '';
		width: 18px;
		height: 20px;
		display: inline-block;
		/* Change path to image*/
		background-image: url(https://qi-xiang.github.io/NCU_Project_Demo/FireBaseDemo/src/jquery-ui-1.13.1.custom/images/ui-icons_777777_256x240.png);
		background-position: -96px -128px;
		background-repeat: no-repeat;
		overflow: hidden;
	}
</style>

</html>