import{initializeApp}from"https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js";import{getAnalytics}from"https://www.gstatic.com/firebasejs/9.8.3/firebase-analytics.js";import{switchChart,hideAllGraph,isNumeric,showdate,getCookie}from"./common_function.js";const firebaseConfig={apiKey:"AIzaSyDtTxfCIJIfPTEw44Ah5I1lpjiDO96FlJM",authDomain:"mydatabase-8f225.firebaseapp.com",databaseURL:"https://mydatabase-8f225-default-rtdb2.firebaseio.com",projectId:"mydatabase-8f225",storageBucket:"mydatabase-8f225.appspot.com",messagingSenderId:"68532714578",appId:"1:68532714578:web:fc038b336827906b65338b",measurementId:"G-68RXLWEXS7"};firebase.initializeApp(firebaseConfig,"db2");var db2=firebase.database(),CurrentPage=0,TotalPage=0,dates=[],journey_keys=[],avg_speed=[],avg_acceleration=[],avg_left_distance=[],avg_right_distance=[],avg_back_distance=[],accel_vio_count=[],speed_vio_count=[],LD_vio_count=[],RD_vio_count=[],BD_vio_count=[],safety_score=[];function chartGraph(e,a,t,r,o){var c=a.slice(0,1);if(e+1<TotalPage){var s=Number(10*e)+Number(1),n=10*e+11;c=c.concat(a.slice(s,n))}else{s=Number(10*e)+Number(1),n=a.length;c=c.concat(a.slice(s,n))}c3.generate({bindto:t,title:{show:!1},data:{type:"line",columns:[c]},axis:{x:{type:"category",categories:dates.slice(s-1,n-1),label:{text:"時間"},tick:{fit:!0}},y:{label:{text:r,position:"outer-middle"},min:0,tick:{count:5,format:d3.format(o)},padding:{bottom:0}}},size:{height:450,width:1024},padding:{bottom:15}})}function chartGraph_special(e){var a=avg_left_distance.slice(0,1),t=avg_right_distance.slice(0,1),r=avg_back_distance.slice(0,1);if(e+1<TotalPage)var o=Number(10*e)+Number(1),c=10*e+11;else o=Number(10*e)+Number(1),c=avg_left_distance.length;a=a.concat(avg_left_distance.slice(o,c)),t=t.concat(avg_right_distance.slice(o,c)),r=r.concat(avg_back_distance.slice(o,c));c3.generate({bindto:"#avg_distance_graph_dropdown #chart",data:{type:"line",columns:[a,r,t]},axis:{x:{type:"category",categories:dates.slice(o-1,c-1),label:{text:"時間"},tick:{fit:!0}},y:{label:{text:"我是單位",position:"outer-middle"},tick:{count:10,format:function(e){return parseInt(e)}},padding:{bottom:0},min:0}},size:{height:450,width:1024},padding:{bottom:15}})}function bar_chartGraph(e,a,t){var r=a.slice(0,1);if(e+1<TotalPage)var o=Number(10*e)+Number(1),c=10*e+11;else o=Number(10*e)+Number(1),c=a.length;r=r.concat(a.slice(o,c));c3.generate({bindto:t,data:{type:"bar",columns:[r]},bar:{width:{ratio:.5}},axis:{x:{type:"category",categories:dates.slice(o-1,c-1),label:{text:"時間"},tick:{fit:!0}},y:{label:{text:"我是單位",position:"outer-middle"}}},size:{height:450,width:1024},padding:{bottom:15}})}function bar_chartGraph_special(e){var a=LD_vio_count.slice(0,1),t=RD_vio_count.slice(0,1),r=BD_vio_count.slice(0,1);if(e+1<TotalPage)var o=Number(10*e)+Number(1),c=10*e+11;else o=Number(10*e)+Number(1),c=avg_left_distance.length;a=a.concat(LD_vio_count.slice(o,c)),t=t.concat(RD_vio_count.slice(o,c)),r=r.concat(BD_vio_count.slice(o,c));c3.generate({bindto:"#avg_distance_vio_count_graph_dropdown #chart",data:{type:"bar",columns:[a,t,r],groups:[["車距違規(左)","車距違規(右)","車距違規(後)"]]},axis:{x:{type:"category",categories:dates.slice(o-1,c-1),label:{text:"時間"},tick:{fit:!0}},y:{label:{text:"我是單位",position:"outer-middle"}}},size:{height:450,width:1024},padding:{bottom:15}})}db2.ref("/Users/"+getCookie("uid")+"/journey").once("value",(function(e){var a=e.val();Object.keys(a).forEach((e=>{isNumeric(e)&&journey_keys.push(e)}));for(var t=0;t<journey_keys.length;t++)dates.push(showdate(new Date(1e3*a[journey_keys[t]].end_time))),avg_speed.push((100*a[journey_keys[t]].speed_stat.avg_speed/100).toFixed(2)),avg_acceleration.push((100*a[journey_keys[t]].acceleration_stat[0].avg_acceleration/100).toFixed(2)),avg_left_distance.push(a[journey_keys[t]].distance_stat[0].avg_distance),avg_right_distance.push(a[journey_keys[t]].distance_stat[1].avg_distance),avg_back_distance.push(a[journey_keys[t]].distance_stat[2].avg_distance),null!=a[journey_keys[t]].acceleration_stat[0].acceleration_violation&&accel_vio_count.push(Object.keys(a[journey_keys[t]].acceleration_stat[0].acceleration_violation).length),null==a[journey_keys[t]].acceleration_stat[0].acceleration_violation&&accel_vio_count.push(0),null!=a[journey_keys[t]].speed_stat.speed_violation&&speed_vio_count.push(Object.keys(a[journey_keys[t]].speed_stat.speed_violation).length),null==a[journey_keys[t]].speed_stat.speed_violation&&speed_vio_count.push(0),null!=a[journey_keys[t]].distance_stat[0].distance_violation&&LD_vio_count.push(Object.keys(a[journey_keys[t]].distance_stat[0].distance_violation).length),null==a[journey_keys[t]].distance_stat[0].distance_violation&&LD_vio_count.push(0),null!=a[journey_keys[t]].distance_stat[1].distance_violation&&RD_vio_count.push(Object.keys(a[journey_keys[t]].distance_stat[1].distance_violation).length),null==a[journey_keys[t]].distance_stat[1].distance_violation&&RD_vio_count.push(0),null!=a[journey_keys[t]].distance_stat[2].distance_violation&&BD_vio_count.push(Object.keys(a[journey_keys[t]].distance_stat[2].distance_violation).length),null==a[journey_keys[t]].distance_stat[2].distance_violation&&BD_vio_count.push(0),null!=a[journey_keys[t]].safety_score&&safety_score.push(a[journey_keys[t]].safety_score),null==a[journey_keys[t]].safety_score&&safety_score.push(0);avg_speed.push("平均速度"),avg_acceleration.push("平均加速度"),avg_left_distance.push("平均車距(左)"),avg_right_distance.push("平均車距(右)"),avg_back_distance.push("平均車距(後)"),accel_vio_count.push("加速度違規次數"),speed_vio_count.push("速度違規次數"),LD_vio_count.push("車距違規(左)"),RD_vio_count.push("車距違規(右)"),BD_vio_count.push("車距違規(後)"),safety_score.push("安全分數"),dates=dates.reverse(),avg_acceleration.reverse(),avg_speed=avg_speed.reverse(),avg_left_distance=avg_left_distance.reverse(),avg_right_distance=avg_right_distance.reverse(),avg_back_distance=avg_back_distance.reverse(),accel_vio_count=accel_vio_count.reverse(),speed_vio_count=speed_vio_count.reverse(),LD_vio_count=LD_vio_count.reverse(),RD_vio_count=RD_vio_count.reverse(),BD_vio_count=BD_vio_count.reverse(),safety_score=safety_score.reverse(),TotalPage=Math.ceil(avg_speed.length/10),document.querySelector(".nextBtn").addEventListener("click",(e=>{CurrentPage+1<TotalPage&&(CurrentPage+=1),chartGraph(CurrentPage,avg_speed,"#avg_speed_graph_dropdown #chart","我是單位",".2f"),chartGraph(CurrentPage,safety_score,"#safety_score_graph_dropdown #chart","我是單位",".1f"),chartGraph(CurrentPage,avg_acceleration,"#avg_acceleration_graph_dropdown #chart","我是單位",".3f"),chartGraph_special(CurrentPage),bar_chartGraph(CurrentPage,accel_vio_count,"#avg_acceleration_vio_count_graph_dropdown #chart"),bar_chartGraph(CurrentPage,speed_vio_count,"#avg_speed_vio_count_graph_dropdown #chart"),bar_chartGraph_special(CurrentPage)})),document.querySelector(".lastBtn").addEventListener("click",(e=>{CurrentPage-1>=0&&(CurrentPage-=1),chartGraph(CurrentPage,avg_speed,"#avg_speed_graph_dropdown #chart","我是單位",".2f"),chartGraph(CurrentPage,safety_score,"#safety_score_graph_dropdown #chart","我是單位",".1f"),chartGraph(CurrentPage,avg_acceleration,"#avg_acceleration_graph_dropdown #chart","我是單位",".3f"),chartGraph_special(CurrentPage),bar_chartGraph(CurrentPage,accel_vio_count,"#avg_acceleration_vio_count_graph_dropdown #chart"),bar_chartGraph(CurrentPage,speed_vio_count,"#avg_speed_vio_count_graph_dropdown #chart"),bar_chartGraph_special(CurrentPage)})),chartGraph(CurrentPage,avg_speed,"#avg_speed_graph_dropdown #chart","我是單位",".2f"),chartGraph(CurrentPage,safety_score,"#safety_score_graph_dropdown #chart","我是單位",".1f"),chartGraph(CurrentPage,avg_acceleration,"#avg_acceleration_graph_dropdown #chart","我是單位",".3f"),chartGraph_special(CurrentPage),bar_chartGraph(CurrentPage,accel_vio_count,"#avg_acceleration_vio_count_graph_dropdown #chart"),bar_chartGraph(CurrentPage,speed_vio_count,"#avg_speed_vio_count_graph_dropdown #chart"),bar_chartGraph_special(CurrentPage),switchChart(),hideAllGraph(),$("#avg_speed_graph_dropdown #chart").fadeIn(500)})),document.querySelector(".dropdownContainer").addEventListener("click",(e=>{$(".dropdownContainer a").css("background-color","white")}));